
# coding: utf-8

# # Media's Tweets Sentiment Analysis (BBC,CBS,CNN,Fox,New Yark Times) 
# ### Tools -Pandas,Matplotlib,Tweepy and vaderSentiment
# (Author:Thanu Thavasi Perumal)

# <b>Objective:</b><br>I am creating a Python script to perform a sentiment analysis of the Twitter activities of various news outlets, and presenting my findings visually.
# 
# My final output would provide a visualized summary of the sentiments expressed in Tweets sent out by the following news organizations: BBC, CBS, CNN, Fox, and New York times.

# In[9]:

import tweepy
import numpy as np
import pandas as pd
from datetime import datetime
import matplotlib.pyplot as plt
get_ipython().magic('matplotlib inline')


# Importing and Initializing Sentiment Analyzer
from vaderSentiment.vaderSentiment import SentimentIntensityAnalyzer
analyzer = SentimentIntensityAnalyzer()

# Twitter API Keys
from config import (consumer_key, 
                    consumer_secret, 
                    access_token, 
                    access_token_secret)

# Tweepy API Authentication
auth = tweepy.OAuthHandler(consumer_key, consumer_secret)
auth.set_access_token(access_token, access_token_secret)
api = tweepy.API(auth, parser=tweepy.parsers.JSONParser())


# In[10]:

target_terms=['BBC','CBS','CNN','Fox','New York Times']


# In[11]:

# Variable for holding sentiments
sentiments = []

# Variable for max_id
oldest_tweet = None

# Looping through each target term to collect their tweets 
for term in target_terms: 
    
    counter = 1 #Counter counts for number of tweets
    public_tweets = api.search(term,count=100,max_id = oldest_tweet)#API search to collect the tweets

    # Loop through all tweets 
    for tweet in public_tweets['statuses']:

        print(f"Tweet {counter}: {tweet['text']}")
        
        # Run Vader Analysis on each tweet
        results = analyzer.polarity_scores(tweet["text"])
        
        #Collecting the sentiment polarities
        compound = results["compound"]
        pos = results["pos"]
        neu = results["neu"]
        neg = results["neg"]
        
        # Assigning tweet['id'] - 1 to oldest_tweet so as to avoid any duplicate tweets
        oldest_tweet = tweet['id'] - 1
        
        # Add sentiment analysis results for each tweet into a list
        sentiments.append({"Name":term,
                            "Date": tweet["created_at"], 
                           "Compound": compound,
                           "Positive": pos,
                           "Negative": neu,
                           "Neutral": neg,
                           "Tweets Ago": counter})
        
        # Incrementing the counter
        counter += 1


# In[12]:

#Converting sentiment list into Dataframe
sentiments_pd = pd.DataFrame.from_dict(sentiments)
sentiments_pd =sentiments_pd.set_index('Name')

#Exporting the dataframe into csv 
sentiments_pd.to_csv("Newsmood.csv") 
sentiments_pd.head()


# In[13]:

#Visuliztion of the reults:
#Plotting the results of 'BBC'
fig,ax=plt.subplots()
x_vals = sentiments_pd.loc['BBC']["Tweets Ago"]
y_vals = sentiments_pd.loc['BBC']["Compound"]
ax.scatter(x_vals,
         y_vals, marker="o",s=100, linewidth=0.5,
         alpha=1,c='r',edgecolors='black',label='BBC')

#Plotting the results of 'CBS'
x_vals = sentiments_pd.loc['CBS']["Tweets Ago"]
y_vals = sentiments_pd.loc['CBS']["Compound"]
ax.scatter(x_vals,
         y_vals, marker="o",s=100, linewidth=0.5,
         alpha=1,c='g',edgecolors='black',label='CBS')

#Plotting the results of 'FOX'
x_vals = sentiments_pd.loc['Fox']["Tweets Ago"]
y_vals = sentiments_pd.loc['Fox']["Compound"]
ax.scatter(x_vals,
         y_vals, marker="o",s=100, linewidth=0.5,
         alpha=1,c='b',edgecolors='black',label='Fox')

#Plotting the results of 'CNN'
x_vals = sentiments_pd.loc['CNN']["Tweets Ago"]
y_vals = sentiments_pd.loc['CNN']["Compound"]
ax.scatter(x_vals,
         y_vals, marker="o",s=100, linewidth=0.5,
         alpha=1,c='y',edgecolors='black',label='CNN')

#Plotting the results of 'New York Times'
x_vals = sentiments_pd.loc['New York Times']["Tweets Ago"]
y_vals = sentiments_pd.loc['New York Times']["Compound"]
ax.scatter(x_vals,
         y_vals, marker="o",s=100, linewidth=0.5,
         alpha=1,c='lightblue',edgecolors='black',label='New York Times')

#Graph properties
now = datetime.now()
now = now.strftime("%Y-%m-%d %H:%M")
plt.title(f"Sentiment Analysis of Tweets {now} ")
plt.legend(loc=(1.02,0.45))
plt.text(-6,0.75,'Media Sources')
plt.xlim(x_vals.max()+5,x_vals.min()-5) 
plt.ylabel("Tweet Polarity")
plt.xlabel("Tweets Ago")
plt.savefig("Sentiment Analysis of Tweets.png")
plt.show()


# In[14]:

#Overall sentiment polarity analysis
sentiments_pd = pd.DataFrame.from_dict(sentiments)
sentiments_pd1=sentiments_pd.reset_index()
sentiments_pd1=sentiments_pd1.groupby("Name").mean()


# In[15]:

sentiments_pd1.reset_index(inplace=True)
sentiments_pd1


# In[16]:

#Visualization of overall sentiment Analysis
fig,ax=plt.subplots()
ax.bar(sentiments_pd1['Name'],sentiments_pd1['Compound'],color=['r','g','y','b','salmon'],align='center',width=1)

now = datetime.now()
now = now.strftime("%Y-%m-%d %H:%M")
plt.title(f"Media Sentiment Analysis based on Twitter ({now})")
plt.ylabel("Tweet Polarity")
plt.xlabel("Media");
plt.xlim(-0.5,4.5)
y=[0.005,0.005,0.005,0.005,0.005]
for i,j in enumerate(y): #Script to add the values on each bar.
    ax.text(i-0.2,j,round(sentiments_pd1['Compound'][i],2) , color='blue', fontweight='bold')
plt.savefig("Media Sentiment Analysis based on Twitter.png")
plt.show()


# # Insights :
# By analysing most recent 100 tweets of these Medias using Veder sentiment analysis package, its inferred that,at this point of time,
# 
# <ul><li> <b>CNN</b> has scored most negative rank based on people's reviews and tweets,and <b>Fox</b> has the second most negartive rank.</li>
# <li> <b>CBS</b> scored most positive sentiment rank and <b>New York Time</b> has the second posivite score, proves that pople have positive ideas in their mind about CBS and BBC.</li>
#  <li><b>BBC</b> has scored a positve ranking but almost near neutral score shows tweets are all of equal impact about this media's activities.</li></ul>
# 

# In[ ]:




# In[ ]:



